<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@1.4.4/css/pico.min.css">
  <link rel="icon" class="js-site-favicon" type="image/svg+xml"
    href="https://github.githubassets.com/favicons/favicon.svg">
  <title>speedtest monitor</title>
  <style>
    h2 {
      margin: 0;
      font-size: 2em;
    }

    small {
      margin: 0;
      font-size: 0.75em;
    }

    ul>li {
      cursor: pointer;
    }

    ul>li:hover {
      color: #017206;
    }
  </style>
</head>

<body>
  <main class="container">
    <h2>speedtest monitor</h2>
    <small>periodically check internet speed</small>
    <hr>
    <div id="results"></div>
  </main>

  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script>
    (async () => {
      const response = await fetch('https://api.github.com/repos/lgu-calape/speedtest/contents/');
      const data = await response.json();
      const ul = document.createElement('ul');

      for (let file of data.sort((a, b) => -1 * a.name.localeCompare(b.name))) {
        if (file.name.indexOf('speedtest-') !== -1) {
          let li = document.createElement('li');

          li.textContent = file.name;
          li.addEventListener('click', () => v(file.path));
          ul.appendChild(li);
        }
      }

      document.getElementById('results').append(ul);
    })()

    function v(f) {
      let x = new XMLHttpRequest();

      x.addEventListener('readystatechange', () => {
        if (x.readyState == 4) {
          if (x.status == 200) {
            let d = JSON.parse(x.responseText);

            swal({
              title: new Date(d.timestamp).toLocaleString(),
              icon: d.result.url + '.png',
              button: 'close',
            });
          }
        }
      });

      x.open('GET', f);
      x.send();
    }
  </script>
</body>

</html>